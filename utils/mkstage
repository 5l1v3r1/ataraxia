#!/bin/bash

main() {
	if [ -z "$LINUX" ]; then
		LINUX="linux"
	fi

	STAGE="$BUILD/stage"

	rm -rf "$STAGE"
	mkdir -p "$STAGE"

	packages="base-files linux-api-headers musl tzdata man-pages musl-tools gettext-tiny zlib file ncurses readline m4 bison flex bc gmp mpfr mpc binutils gcc \
		ccache bzip2 pkgconf attr acl libcap pcre grep mksh bash libtool gdbm db expat perl nettle libressl ca-certificates \
		autoconf automake xz lzip lz4 zstd libarchive kmod musl-fts musl-obstack libuargp libelf busybox mandoc dialog pigz libmnl libnftnl \
		libnfnetlink libnetfilter_conntrack libnl libpcap iptables iproute2 kbd make patch tar vim libcap-ng util-linux e2fsprogs libaal reiser4progs \
		hwids gperf eudev $LINUX dhcpcd dpkg libssh2 c-ares libev nghttp2 curl ne"

	ne -c "$BUILD"/target.config -r "$STAGE" -EWn $packages

	pushd "$STAGE"
		bsdtar -c --zstd -f "$BUILD"/ataraxialinux-$BARCH.tar.zst .
	popd
}
