# Description: D-Bus interface for user account query and manipulation
# URL:         https://gitlab.freedesktop.org/accountsservice/accountsservice
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  meson gobject-introspection libgcrypt polkit
# Section:     admin

name=accountsservice
version=0.6.47
release=1
source=("https://www.freedesktop.org/software/$name/$name-$version.tar.xz")

build() {
	cd "$SRC"/$name-$version
	patch -Np1 -i "$STUFF"/accountsservice/accountsservice-0.6.50-loaded-state.patch
	patch -Np1 -i "$STUFF"/accountsservice/musl-fgetspent_r.patch

	sed -i configure -e "s;utx\.log;wtmp;g"
	export ac_cv_file__var_log_utx_log=yes

	./configure $BUILDFLAGS \
		--prefix=/usr \
		--libexecdir=/usr/lib \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--enable-admin-group=wheel \
		--disable-gtk-doc \
		--disable-systemd
	make
	make DESTDIR="$PKG" install
}
