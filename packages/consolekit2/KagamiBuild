# Description: Framework for defining and tracking users, login sessions, and seats
# URL:         https://github.com/ConsoleKit2/ConsoleKit2
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  zlib pam acl eudev dbus-glib libx11 polkit pm-utils
# Section:     admin

name=consolekit2
version=1.2.1
release=9
source=("https://github.com/Consolekit2/ConsoleKit2/releases/download/$version/ConsoleKit2-$version.tar.bz2")

build() {
	cd "$SRC"/ConsoleKit2-$version
	./configure $BUILDFLAGS \
		--prefix=/usr \
		--libexecdir=/usr/lib/consolekit \
		--sbindir=/usr/bin \
		--sysconfdir=/etc \
		--with-rundir=/run \
		--localstatedir=/var \
		--with-dbus-services=/usr/share/dbus-1/services \
		--with-dbus-sys=/usr/share/dbus-1/system.d \
		--with-pam-module-dir=/usr/lib/security \
		--with-xinitrc-dir=/etc/X11/xinit/xinitrc.d \
		--without-systemdsystemunitdir \
		--enable-polkit \
		--enable-udev-acl
	make
	make DESTDIR="$PKG" install

	mkdir -p "$PKG"/etc/ConsoleKit/run-session.d \
		"$PKG"/usr/lib/ConsoleKit/run-seat.d \
		"$PKG"/usr/lib/ConsoleKit/run-session.d \
		"$PKG"/var/log/ConsoleKit

	install -Dm755 "$STUFF"/consolekit2/pam-foreground-compat.ck "$PKG"/etc/ConsoleKit/run-session.d/40-ConsoleKit
	install -Dm755 "$STUFF"/consolekit2/40-ConsoleKit "$PKG"/etc/X11/xinit/xinitrc.d/40-ConsoleKit

	rm -rf "$PKG"/run

	for rc in consolekit; do
		install -Dm755 "$STUFF"/perpd/$rc "$PKG"/etc/perp/$rc/rc.main
		install -Dm755 "$STUFF"/perpd/log "$PKG"/etc/perp/$rc/rc.log
	done
}
