# Description: Utilities to handle ELF object files and DWARF debugging information
# URL:         https://sourceware.org/elfutils/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  zlib bzip2 xz libuargp
# Priority:    required
# Section:     devel

name=libelf
version=0.177
release=1
options=('bootstrap')
source=("https://sourceware.org/elfutils/ftp/$version/elfutils-$version.tar.bz2")

build() {
	cd "$SRC"/elfutils-$version
	patch -Np1 -i "$STUFF"/libelf/0006-Fix-build-on-aarch64-musl.patch
	patch -Np1 -i "$STUFF"/libelf/0007-Fix-control-path-where-we-have-str-as-uninitialized-.patch
	patch -Np1 -i "$STUFF"/libelf/musl-libs.patch
	patch -Np1 -i "$STUFF"/libelf/musl-tests.patch
	patch -Np1 -i "$STUFF"/libelf/musl-utils.patch
	patch -Np1 -i "$STUFF"/libelf/no-werror.patch

	autoreconf -fiv

	./configure $TOOLFLAGS \
		--prefix=/usr \
		--enable-deterministic-archives \
		--disable-nls \
		--disable-werror
	make -C lib
	make -C libelf
	make -C libelf DESTDIR="$PKG" install

	mkdir -p "$PKG"/usr/lib/pkgconfig
	cp config/libelf.pc "$PKG"/usr/lib/pkgconfig
}
