# Description: Tool to help find memory-management problems in programs
# URL:         http://valgrind.org/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  perl

name=valgrind
version=3.15.0
release=1
source=("ftp://sourceware.org/pub/$name/$name-$version.tar.bz2")
NO_RUN_STRIP=1
NO_EMPTY_DIRS=1

build() {
	case $BARCH in
		ppc64le|ppc64)
			echo "PowerPC64 is not supported"
			exit 1
	esac

	export CFLAGS="$CFLAGS -fno-stack-protector -no-pie"
	export CXXFLAGS="$CXXFLAGS -fno-stack-protector -no-pie"

	cd "$SRC"/$name-$version
	./configure $BUILDFLAGS \
		--prefix=/usr \
		--without-mpicc \
		--enable-tls
	make
	make DESTDIR="$PKG" install

	find "$PKG"/usr/bin -type f -executable -exec strip --strip-all {} + || true
}
