# Description: Miscellaneous system utilities for Linux 
# URL:         http://git.kernel.org/cgit/utils/util-linux/util-linux.git
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  zlib readline libcap-ng
# Priority:    required
# Section:     utils

name=util-linux
version=2.34
case $version in
	*.*.*) _v=${version%.*};;
	*.*) _v=$version;;
esac
release=3
options=('bootstrap')
source=("https://www.kernel.org/pub/linux/utils/util-linux/v${_v}/$name-$version.tar.xz")

build() {
	cd "$SRC"/$name-$version
	ADJTIME_PATH=/var/lib/hwclock/adjtime \
	./configure $BUILDFLAGS \
		--prefix=/usr \
		--libdir=/usr/lib \
		--bindir=/usr/bin \
		--sbindir=/usr/bin \
		--localstatedir=/var \
		--with-btrfs \
		--with-readline \
		--without-python \
		--without-systemd \
		--without-systemdsystemunitdir \
		--enable-all-programs \
		--enable-fs-paths-default=/usr/bin \
		--enable-fdisks \
		--enable-fsck \
		--enable-hwclock \
		--enable-libblkid \
		--enable-libfdisk \
		--enable-libmount \
		--enable-libsmartcols \
		--enable-libuuid \
		--enable-losetup \
		--enable-mesg \
		--enable-mount \
		--enable-mountpoint \
		--enable-partx \
		--enable-raw \
		--enable-rfkill \
		--enable-tunelp \
		--enable-wall \
		--enable-write \
		--enable-zramctl \
		--disable-agetty \
		--disable-bfs \
		--disable-cal \
		--disable-chfn-chsh \
		--disable-chmem \
		--disable-cramfs \
		--disable-eject \
		--disable-fallocate \
		--disable-fdformat \
		--disable-hardlink \
		--disable-ipcrm \
		--disable-ipcs \
		--disable-kill \
		--disable-last \
		--disable-line \
		--disable-login \
		--disable-lslogins \
		--disable-lsmem \
		--disable-makeinstall-chown \
		--disable-minix \
		--disable-more \
		--disable-newgrp \
		--disable-nls \
		--disable-nologin \
		--disable-nsenter \
		--disable-pg \
		--disable-pivot_root \
		--disable-rename \
		--disable-rpath \
		--disable-runuser \
		--disable-schedutils \
		--disable-setpriv \
		--disable-setterm \
		--disable-su \
		--disable-sulogin \
		--disable-switch_root \
		--disable-ul \
		--disable-unshare \
		--disable-utmpdump \
		--disable-vipw \
		--disable-wdctl
	make
	make DESTDIR="$PKG" install

	cd "$PKG"
	mkdir -p var/lib/hwclock

	mv usr/sbin/* usr/bin
	rm -rf bin sbin usr/sbin

	rm -rf "$PKG"/usr/bin/ctrlaltdel

	for rc in uuid; do
		install -Dm755 "$STUFF"/perpd/$rc "$PKG"/etc/perp/$rc/rc.main
		install -Dm755 "$STUFF"/perpd/log "$PKG"/etc/perp/$rc/rc.log
	done

	if [ "$EMBEDDED" = "1" ]; then
		rm -rf "$PKG"/usr/bin
	fi
}
