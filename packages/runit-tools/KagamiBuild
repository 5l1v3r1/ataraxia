# Description: A replacement for sysvinit, and other init schemes, with service supervision
# URL:         http://smarden.org/runit/
# Maintainer:  nee-san, nagakamira at gmail dot com

name=runit-tools
version=2.1.2
release=1
options=('bootstrap')
source=("http://smarden.org/runit/runit-$version.tar.gz")

build() {
	mkdir -p "$PKG"/usr/bin

	cd "$SRC"/admin/runit-$version/src

	if [ "$USEBOOTSTRAP" = "yes" ]; then
		echo "$CC $CFLAGS -static" > conf-cc
		echo "$CC -s -static" > conf-ld
		sed -i "s,strip,$STRIP,g" Makefile
	else
		echo "cc $CFLAGS -static" > conf-cc
		echo "cc -s -static" > conf-ld
	fi

	make chpst utmpset 

	for cmds in chpst utmpset; do
		install -Dm775 $cmds "$PKG"/usr/bin/$cmds
	done

	${CROSS_COMPILE}cc $CFLAGS -static "$STUFF"/runit-tools/start-stop-daemon.c -o "$PKG"/usr/bin/start-stop-daemon
}
