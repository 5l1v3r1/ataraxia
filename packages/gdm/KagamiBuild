# Description: Display manager and login screen (libraries only)
# URL:         https://wiki.gnome.org/Projects/GDM
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  accountsservice gtk iso-codes itstool libcanberra
# Section:     gnome

name=gdm
version=3.34.0
release=1
source=("http://ftp.gnome.org/pub/gnome/sources/$name/${version%.*}/$name-$version.tar.xz")

build() {
	cd "$SRC"/$name-$version
	patch -Np1 -i "$STUFF"/gdm/gdm.patch
	patch -Np1 -i "$STUFF"/gdm/fix.patch
	autoreconf -vif

	./configure $BUILDFLAGS \
		--prefix=/usr \
		--libexecdir=/usr/lib \
		--sbindir=/usr/bin \
		--sysconfdir=/etc \
		--localstatedir=/var \
		with_dbus_sys=/usr/share/dbus-1/system.d \
		--with-default-path=/usr/local/bin:/usr/local/sbin:/usr/bin \
		--with-systemdsystemunitdir=no \
		--without-plymouth \
		--without-systemd \
		--with-console-kit \
		--enable-authentication-scheme=shadow \
		--enable-gdm-xsession \
		--enable-ipv6 \
		--disable-schemas-compile \
		--disable-systemd-journal
	make -C common
	make -C libgdm
	make -C data
	make DESTDIR="$PKG" -C common install
	make DESTDIR="$PKG" -C libgdm install
	make DESTDIR="$PKG" -C data install

	rm -rf "$PKG"/etc/pam.d
}
