# Description: The Linux kernel
# URL:         https://www.kernel.org/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  kmod bc libelf xz libressl

name=linux
version=5.1.8
reiser4ver=5.0.0
release=2
source=("https://cdn.kernel.org/pub/linux/kernel/v5.x/$name-$version.tar.xz"
	"https://sourceforge.net/projects/reiser4/files/reiser4-for-linux-5.x/reiser4-for-$reiser4ver.patch.gz")
BOOTSTRAP=yes
NO_RUN_STRIP=1

yconfig() {
	while [ $# -ne 0 ]; do
		./scripts/config --enable $1
		shift 1
	done
}

mconfig() {
	while [ $# -ne 0 ]; do
		./scripts/config --module $1
		shift 1
	done
}

nconfig() {
	while [ $# -ne 0 ]; do
		./scripts/config --disable $1
		shift 1
	done
}

varconfig() {
	FUONE="$1"
	FUTWO="$2"

	./scripts/config --set-val "$FUONE" "$FUTWO"
}

strconfig() {
	FUONE="$1"
	FUTWO="$2"

	./scripts/config --set-str "$FUONE" "$FUTWO"
}

generate_config() {
	case $BARCH in
		x86_64|i586)
			SUBKARCH="x86"
			;;
		*)
			SUBKARCH="$XKARCH"
			;;
	esac

	case $BARCH in
		x86_64)
			export DEFCONFIG="x86_64_defconfig"
			;;
		i586)
			export DEFCONFIG="i386_defconfig"
			;;
		aarch64)
			export DEFCONFIG="defconfig"
			;;
		armv7l)
			export DEFCONFIG="multi_v7_defconfig"
			;;
		armv6l)
			export DEFCONFIG="versatile_defconfig"
			;;
		armv5tel)
			export DEFCONFIG="multi_v5_defconfig"
			;;
		mips|mipsel)
			export DEFCONFIG="malta_defconfig"
			;;
		ppc64le)
			export DEFCONFIG="pseries_le_defconfig"
			;;
		ppc64)
			case $BPPCBOARD in
				pseries)
					export DEFCONFIG="pseries_defconfig"
					;;
				ps3)
					export DEFCONFIG="ps3_defconfig"
					;;
				*)
					export DEFCONFIG="g5_defconfig"
					;;
			esac
			;;
		ppc)
			export DEFCONFIG="pmac32_defconfig"
			;;
		s390x)
			export DEFCONFIG="performance_defconfig"
			;;
		riscv64|riscv32)
			export DEFCONFIG="defconfig"
			;;
		*)
			echo "Architecture is not set or is not supported by Ataraxia Linux"
			exit 1
	esac

	if [ "$CROSS" = "yes" ]; then
		make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} $DEFCONFIG
	else
		make ARCH=$XKARCH $DEFCONFIG
	fi

	case $BARCH in
		x86_64)
			yconfig 64BIT PCI E1000 SERIAL_8250 SERIAL_8250_CONSOLE RTC_CLASS IA32_EMULATION \
				EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS \
				NUMA AMD_NUMA NODES_SPAN_OTHER_NODES NEED_MULTIPLE_NODES USE_PERCPU_NUMA_NODE_ID ACPI_NUMA \
				MICROCODE MICROCODE_EARLY MICROCODE_INTEL MICROCODE_AMD X86_PM_TIMER 
			nconfig NUMA_EMU XEN_DEBUG_FS
			mconfig KVM_INTEL KVM_AMD FB_HYPERV VBOXGUEST HYPERV HYPERV_UTILS \
				HYPERV_MOUSE HYPERV_STORAGE HYPERV_NET HYPERV_BALLOON
			varconfig XEN_BALLOON_MEMORY_HOTPLUG_LIMIT 512
			varconfig NODES_SHIFT 6
			;;
		i586)
			yconfig M586 PCI E1000 SERIAL_8250 SERIAL_8250_CONSOLE RTC_CLASS \
				EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS \
				MICROCODE MICROCODE_EARLY MICROCODE_INTEL MICROCODE_AMD X86_PM_TIMER
			mconfig KVM_INTEL KVM_AMD FB_HYPERV VBOXGUEST HYPERV HYPERV_UTILS \
				HYPERV_MOUSE HYPERV_STORAGE HYPERV_NET HYPERV_BALLOON
			;;
		mips64|mips64el|mips|mipsel)
			yconfig SERIAL_8250 SERIAL_8250_CONSOLE PCI NET_VENDOR_AMD PCNET32 POWER_RESET POWER_RESET_SYSCON
			;;
		riscv64)
			yconfig RISCV_ISA_C RISCV_ISA_A FPU SIFIVE_PLIC
			;;
		riscv32)
			yconfig 32BIT ARCH_RV32I MAXPHYSMEM_2GB LBDAF GENERIC_ATOMIC64 \
				GENERIC_LIB_ASHLDI3 GENERIC_LIB_ASHRDI3 GENERIC_LIB_LSHRDI3 \
				GENERIC_LIB_UCMPDI2 GENERIC_LIB_UMODDI3 \
				RISCV_ISA_C RISCV_ISA_A FPU SIFIVE_PLIC
			nconfig ARCH_RV64I
			;;
	esac

	case $BARCH in
		mips)
			sed -i -e 's:CONFIG_CPU_LITTLE_ENDIAN:CONFIG_CPU_BIG_ENDIAN:' .config
			;;
		mipsel)
			sed -i -e 's:CONFIG_CPU_BIG_ENDIAN:CONFIG_CPU_LITTLE_ENDIAN:' .config
			;;
	esac

	nconfig EMBEDDED KERNEL_GZIP KERNEL_BZIP2 KERNEL_LZMA KERNEL_LZO KERNEL_LZ4 \
		HZ_100 HZ_250 HZ_1000 CC_OPTIMIZE_FOR_PERFORMANCE PREEMPT_NONE PREEMPT_VOLUNTAR SCHED_DEBUG \
		COMPAT_VDSO FW_LOADER_USER_HELPER SYSFS_DEPRECATED L2TP_DEBUGFS CFG80211_DEBUGFS \
		CFG80211_INTERNAL_REGDB CFG80211_CRDA_SUPPORT DEFAULT_SECURITY_SELINUX DEFAULT_SECURITY_SMACK \
		DEFAULT_SECURITY_APPARMOR DEFAULT_SECURITY_DAC PNP_DEBUG PARPORT_PC_FIFO PARPORT_PC_SUPERIO \
		SLIP_MODE_SLIP6 IPV6_SUBTREES RDS_DEBUG IP_VS_DEBUG DM_MULTIPATH_RDAC DM_MULTIPATH_EMC DM_MULTIPATH_HP \
		MODULE_COMPRESS_GZ KEYBOARD_XTKBD KEYBOARD_NEWTON KEYBOARD_LKKBD KEYBOARD_ADC

	# core
	yconfig SMP EARLY_PRINTK BINFMT_ELF BINFMT_SCRIPT NO_HZ HIGH_RES_TIMERS HZ_300 PREEMPT CC_OPTIMIZE_FOR_SIZE \
		BLK_DEV FRAMEBUFFER_CONSOLE_DEFERRED_TAKEOVER KERNEL_XZ MODULE_COMPRESS MODULE_COMPRESS_XZ \
		MODULES MODULE_FORCE_LOAD MODULE_UNLOAD MODULE_FORCE_UNLOAD MODULE_SRCVERSION_ALL \
		HAVE_KERNEL_GZIP HAVE_KERNEL_BZIP2 HAVE_KERNEL_LZMA HAVE_KERNEL_XZ HAVE_KERNEL_LZO HAVE_KERNEL_LZ4 \
		RD_GZIP RD_BZIP2 RD_LZMA RD_XZ RD_LZO RD_LZ4 IKCONFIG IKCONFIG_PROC IKPROC GPIO_SYSFS IKPRO DEVTMPFS TMPFS UNIX SHMEM \
		CGROUPS NAMESPACES IPC_NS NET_NS SYSVIP BINFMT_SCRIPT DEVTMPFS DEVTMPFS_MOUNT EXPERT \
		DMIID EPOLL FHANDLE FS_POSIX_ACL EXPORTFS FILE_LOCKING MANDATORY_FILE_LOCKING \
		FS_ENCRYPTION FSNOTIFY DNOTIFY INOTIFY_USER FANOTIFY GENERIC_ACL IPV6 NET NET_NS PROC_FS \
		PROC_KCORE PROC_SYSCTL PROC_PAGE_MONITOR PROC_DEVICETREE TIMER_STATS SECCOMP SECCOMP_FILTER \
		SIGNALFD SYSFS TIMERFD TMPFS_POSIX_ACL TMPFS_XATTR ANON_INODES BLOCK EVENTFD FSNOTIFY \
		INET NLATTR CGROUP_SCHED FAIR_GROUP_SCHED CFS_BANDWIDTH SCHEDSTATS PID_NS NET_NS SECCOMP_FILTER \
		USER_NS ADVISE_SYSCALLS I2C_CHARDEV PARTITION_ADVANCED EFI_PARTITION OSF_PARTITION \
		AMIGA_PARTITION SGI_PARTITION SUN_PARTITION KARMA_PARTITION MAC_PARTITION MAGIC_SYSRQ \
		AUTOFS4_FS BLK_DEV_BSG CGROUPS CHECKPOINT_RESTORE CMDLINE_BOOL SYSCTL \
		POSIX_MQUEUE POSIX_MQUEUE_SYSCTL KERNFS SYSFS CONFIGFS_FS MISC_FILESYSTEMS \
		NLS NLS_CODEPAGE_437 NLS_ASCII NLS_ISO8859_1 NLS_UTF8 INPUT INPUT_LEDS \
		MOUSE_INPUT_KEYBOARD KEYBOARD_ATKBD MOUSE_KEYBOARD_SUNKBD MOUSE_PS2_ALPS MOUSE_PS2_BYD MOUSE_PS2_LOGIPS2PP MOUSE_PS2_SYNAPTICS \
		MOUSE_PS2_SYNAPTICS_SMBUS MOUSE_PS2_CYPRESS MOUSE_PS2_LIFEBOOK MOUSE_PS2_TRACKPOINT MOUSE_PS2_ELANTECH INPUT_MOUSEDEV INPUT_MOUSEDEV_PSAUX \
		MOUSE_PS2_ELANTECH_SMBUS MOUSE_PS2_SENTELIC MOUSE_PS2_TOUCHKIT MOUSE_PS2_FOCALTECH MOUSE_PS2_VMMOUSE MOUSE_PS2_SMBUS MOUSE_ELAN_I2C_I2C \
		INPUT_MOUSE MOUSE_PS2 MOUSE_ELAN_I2C_SMBUS INPUT_FF_MEMLESS INPUT_POLLDEV INPUT_EVDEV MOUSEDEV MOUSE_PS2 MOUSE_PS2_ALPS MOUSE_PS2_BYD \
		MOUSE_PS2_LOGIPS2PP MOUSE_PS2_SYNAPTICS MOUSE_SYNAPTICS_I2C MOUSE_SYNAPTICS_USB MOUSE_PS2_CYPRESS MOUSE_PS2_LIFEBOOK MOUSE_PS2_TRACKPOINT INPUT_MISC INPUT_UINPUT \
		SERIO SERIO_I8042 SERIO_SERPORT SERIO_LIBPS2 HID HIDRAW UHID HID_GENERIC USB_HID USB_HIDDE INPUT_TOUCHSCREEN TOUCHSCREEN_PROPERTIES \
		NEW_LEDS LEDS_CLASS VIRTUALIZATION IRQ_BYPASS_MANAGER KVM_GUEST \
		NET INET NETFILTER NETFILTER_ADVANCED AUDIT AUDITSYSCALL \
		SYSVIPC IP_VS_PROTO_TCP IP_VS_PROTO_UDP XFRM XFRM_USER XFRM_ALGO \
		NET_L3_MASTER_DEV INET_XFRM_MODE_TRANSPOR NET_L3_MASTER_DEV \
		NAMESPACES NET_NS PID_NS IPC_NS UTS_NS CGROUPS CGROUP_CPUACCT \
		CGROUP_DEVICE FREEZER CGROUP_FREEZER CGROUP_SCHED CPUSETS MEMCG \
		KEYS NF_NAT_NEEDED POSIX_MQUEUE USER_NS SECCOMP CGROUP_PIDS MEMCG_SWAP \
		MEMCG_SWAP_ENABLED LEGACY_VSYSCALL_EMULAT BLK_CGROUP BLK_DEV_THROTTLING \
		CGROUP_PERF CGROUP_HUGETLB CGROUP_NET_PRIO CFS_BANDWIDTH FAIR_GROUP_SCHED \
		RT_GROUP_SCHED IP_VS_NFCT NETPOLL NET_POLL_CONTROLLER NETDEVICES NET_CORE \
		NETPOLL NET_POLL_CONTROLLER PACKET UNIX INET IP_MULTICAST INET_LRO TCP_CONG_CUBIC \
		IP_MROUTE PV6_NDISC_NODETYPE NET_PTP_CLASSIFY HAVE_NET_DSA DNS_RESOLVER \
		RPS RFS_ACCEL XPS NET_RX_BUSY_POLL BQL NET_FLOW_LIMIT DST_CACHE \
		MAY_USE_DEVLINK OF_NET RFKILL RFKILL_PM RFKILL_LEDS HAVE_NET_DSA \
		WIRELESS WEXT_CORE CFG80211_DEFAULT_PS CFG80211_INTERNAL_REGDB \
		MAC80211_HAS_RC MAC80211_RC_MINSTREL MAC80211_RC_MINSTREL_HT \
		MAC80211_RC_MINSTREL_VHT MAC80211_RC_DEFAULT_MINSTREL MAC80211_LEDS \
		ATM_DRIVERS USB_NET_DRIVERS IEEE802154_DRIVERS V4L_PLATFORM_DRIVERS V4L_MEM2MEM_DRIVERS V4L_TEST_DRIVERS DVB_PLATFORM_DRIVERS \
		CEC_PLATFORM_DRIVERS SDR_PLATFORM_DRIVERS SND_DRIVERS VIRT_DRIVERS COMEDI_MISC_DRIVERS COMEDI_PCI_DRIVERS COMEDI_PCMCIA_DRIVERS \
		COMEDI_USB_DRIVERS MOUSE_APPLETOUCH DRM DRM_MIPI_DSI DRM_DP_AUX_CHARDEV DRM_KMS_HELPER DRM_KMS_FB_HELPER DRM_TTM DRM_GEM_CMA_HELPER DRM_KMS_CMA_HELPER DRM_VM \
		NET_VENDOR_3COM NET_VENDOR_ADAPTEC NET_VENDOR_AGERE NET_VENDOR_ALACRITECH NET_VENDOR_ALTEON NET_VENDOR_AMAZON NET_VENDOR_AMD \
		NET_VENDOR_AQUANTIA NET_VENDOR_ARC NET_VENDOR_ATHEROS NET_VENDOR_AURORA NET_VENDOR_BROADCOM _NET_VENDOR_BROCADE NET_VENDOR_CAVIUM \
		NET_VENDOR_CHELSIO NET_VENDOR_CISCO NET_VENDOR_CORTINA NET_VENDOR_DEC NET_VENDOR_DLINK NET_VENDOR_EMULEX NET_VENDOR_EZCHIP NET_VENDOR_EXAR \
		NET_VENDOR_FUJITSU NET_VENDOR_HP NET_VENDOR_HUAWEI NET_VENDOR_INTEL NET_VENDOR_EXAR NET_VENDOR_MARVELL NET_VENDOR_MELLANOX NET_VENDOR_MICREL \
		NET_VENDOR_MICROCHIP NET_VENDOR_MYRI NET_VENDOR_NATSEMI NET_VENDOR_NETRONOME NET_VENDOR_NI NET_VENDOR_8390 NET_VENDOR_NVIDIA NET_VENDOR_OKI \
		NET_VENDOR_QLOGIC NET_VENDOR_QUALCOMM NET_VENDOR_REALTEK NET_VENDOR_RENESAS NET_VENDOR_RDC NET_VENDOR_ROCKER NET_VENDOR_SAMSUNG NET_VENDOR_SEEQ \
		NET_VENDOR_SILAN NET_VENDOR_SIS NET_VENDOR_SOLARFLARE NET_VENDOR_SMSC NET_VENDOR_SOCIONEXT NET_VENDOR_STMICRO VENDOR_SUN NET_VENDOR_TEHUTI \
		NET_VENDOR_TI NET_VENDOR_VIA NET_VENDOR_WIZNET NET_VENDOR_XIRCOM NET_VENDOR_SYNOPSYS NET_VENDOR_IBM NET_VENDOR_MICROSEMI NET_VENDOR_RDC \
		NET_VENDOR_I825XX NET_VENDOR_3COM NET_VENDOR_NATSEMI NET_VENDOR_8390 \
		WLAN_VENDOR_ADMTEK WLAN_VENDOR_ATH WLAN_VENDOR_ATMEL WLAN_VENDOR_BROADCOM WLAN_VENDOR_CISCO WLAN_VENDOR_INTEL WLAN_VENDOR_INTERSIL \
		WLAN_VENDOR_MARVELL WLAN_VENDOR_MEDIATEK WLAN_VENDOR_RALINK WLAN_VENDOR_REALTEK WLAN_VENDOR_RSI WLAN_VENDOR_ST WLAN_VENDOR_TI WLAN_VENDOR_ZYDAS WLAN_VENDOR_QUANTENNA \
		PHYLIB SWPHY SWAP MEMCG_SWAP MEMCG_SWAP_ENABLED ZSMALLOC ZRAM \
		TTY SECURITY SECURITY_PATH SECURITY_NETWORK SECURITY_TOMOYO SECURITYFS KALLSYMS DEFAULT_SECURITY_TOMOYO \
		OPTIMIZE_INLINING KEXEC KEXEC_FILE MULTIUSER FILE_LOCKING MANDATORY_FILE_LOCKING NETWORK_FILESYSTEMS \
		SUNRPC SUNRPC_GSS SUNRPC_BACKCHANNEL SUNRPC_SWAP PNP ISAPNP CPI_PCI_SLOT OTPLUG_PCI_ACPI HOTPLUG_PCI_ACPI_IBM \
		PARPORT PARPORT_PC PARPORT_SERIAL PARPORT_PC_PCMCIA PARPORT_1284 FB FRAMEBUFFER_CONSOLE \
		FRAMEBUFFER_CONSOLE_DETECT_PRIMARY FRAMEBUFFER_CONSOLE_ROTATION FONTS VT CONSOLE_TRANSLATIONS VT_CONSOLE T_HW_CONSOLE_BINDING \
		FDDI SLIP_COMPRESSED SLIP_SMART IPPP_FILTER KVM FB FIRMWARE_EDID FB_CMDLINE FB_BOOT_VESA_SUPPORT FB_CFB_FILLRECT FB_CFB_COPYAREA \
		FB_CFB_IMAGEBLIT FB_VESA FB_SIMPLE IP_ADVANCED_ROUTER IP_MULTIPLE_TABLES IP_ROUTE_TOS IP_ROUTE_LARGE_TABLE \
		OPENVSWITCH_GRE OPENVSWITCH_VXLAN OPENVSWITCH_GENEVE RPS RFS_ACCEL NETLINK_MMAP BATMAN_ADV_BLA \
		ACPI ACPI_PROCESSOR ACPI_LEGACY_TABLES_LOOKUP ACPI_PROCFS_POWER ACPI_NUMA HAVE_ACPI_APEI HAVE_ACPI_APEI_NMI \
		BPF BPF_SYSCALL BPF_JIT EXPERT HIBERNATION SUSPEND HWMON FONT_8x8 FONT_8x16 SUN8x16

	# core (modules)
	mconfig I2C_HID INPUT_GPIO_ROTARY_ENCODER INPUT_JOYDEV INPUT_POLLDEV INPUT_MATRIXKMAP VHOST_NET VHOST_VSOCK \
		MACVTAP VXLAN INET_ESP IPVLAN DUMMY IP_VS_RR IP_VS NET_CLS_CGROU VETH MACVLAN MACSEC NETCONSOLE VIRTIO_NET \
		TUN PPP PPP_BSDCOMP PPP_DEFLATE PPP_MPPE PPPOE PPPOLAC PPPOPNS PPP_ASYNC SLHC L2TP L2TP_V3 L2TP_IP L2TP_ETH \
		IPV6_SIT STP NET_IP_TUNNEL IP_MROUTE INET_TUNNEL VLAN_8021Q LLC MAC80211 CFG80211 DRM_SCHED SLIP \
		IP_VS IP_VS_PROTO_TCP IP_VS_PROTO_UDP IP_VS_PROTO_ESP IP_VS_PROTO_AH \
		IP_VS_RR IP_VS_WRR IP_VS_LC IP_VS_WLC IP_VS_LBLC IP_VS_LBLCR IP_VS_DH IP_VS_SH IP_VS_SED \
		IP_VS_NQ IP_VS_FTP IPV6_PRIVACY IPV6_ROUTER_PREF IPV6_ROUTE_INFO IPV6_OPTIMISTIC_DAD \
		INET6_AH INET6_ESP INET6_IPCOMP IPV6_MIP6 IPV6_SIT IPV6_TUNNEL IPV6_MULTIPLE_TABLES \
		IPV6_MROUTE IPV6_PIMSM_V2 RDS RDS_RDMA RDS_TCP FB_VGA16 VSOCKETS LLC DNS_RESOLVER \
		BATMAN_ADV OPENVSWITCH VSOCKETS VMWARE_VMCI_VSOCKETS NETLINK_DIAG NET_MPLS_GSO HSR XPS \
		ACPI_FAN ACPI_IPMI ACPI_THERMAL ACPI_EXTLOG NET_ACT_BPF MOUSE_VSXXXAA MOUSE_GPIO MOUSE_SYNAPTICS_I2C MOUSE_SYNAPTICS_USB \
		MOUSE_SERIAL MOUSE_APPLETOUCH MOUSE_BCM5974 MOUSE_CYAPA MOUSE_ELAN_I2C KEYBOARD_TM2_TOUCHKEY KEYBOARD_CROS_EC KEYBOARD_MTK_PMIC \
		KEYBOARD_ADP5588 KEYBOARD_ADP5589 KEYBOARD_QT1070 KEYBOARD_QT2160 KEYBOARD_DLINK_DIR685 \
		KEYBOARD_GPIO KEYBOARD_GPIO_POLLED KEYBOARD_TCA6416 KEYBOARD_TCA8418 KEYBOARD_MATRIX KEYBOARD_LM8323 \
		KEYBOARD_LM8333 KEYBOARD_MAX7359 KEYBOARD_MCS KEYBOARD_MPR121 KEYBOARD_OPENCORES KEYBOARD_SAMSUNG KEYBOARD_STOWAWAY \
		VHOST_NET VHOST_SCSI VHOST_VSOCK VHOST

	# filesystems
	yconfig SQUASHFS SQUASHFS_DECOMP_MULTI SQUASHFS_FILE_DIRECT \
		SQUASHFS_LZ4 SQUASHFS_LZO SQUASHFS_XATTR SQUASHFS_XZ SQUASHFS_ZLIB SQUASHFS_ZSTD \
		OVERLAY_FS OVERLAY_FS_REDIRECT_DIR _OVERLAY_FS_INDEX OVERLAY_FS_REDIRECT_ALWAYS_FOLLOW \
		OVERLAY_FS_NFS_EXPORT OVERLAY_FS_XINO_AUTO VERLAY_FS_METACOPY \
		REISER4_FS EXT4_FS EXT4_USE_FOR_EXT2 EXT4_FS_POSIX_ACL EXT4_FS_SECURITY EXT4_USE_FOR_EXT2 \
		FAT_FS VFAT_FS FAT_DEFAULT_UTF8 NTFS_FS NTFS_RW JBD2 FS_MBCACHE UBIFS_FS UBIFS_FS_LZO UBIFS_FS_ZLIB \
		BTRFS_FS BTRFS_FS_POSIX_ACL BTRFS_FS_CHECK_INTEGRITY REISERFS_FS REISERFS_FS_XATTR JFS_FS JFS_SECURITY \
		XFS_FS XFS_QUOTA CRYPTO_LZ4 CRYPTO_LZ4HC F2FS_FS F2FS_FS_XATTR F2FS_FS_POSIX_ACL F2FS_FS_SECURITY F2FS_STAT_FS F2FS_CHECK_FS ISO9660_FS JOLIET ZISOFS \
		UDF_FS UDF_NLS MISC_FILESYSTEMS HFS_FS HFSPLUS_FS 9P_FS 9P_FS_POSIX_ACL 9P_FS_SECURITY 9P_FSCACHE \
		NFS_V2 NFS_V3 NFS_V3_ACL NFS_V4 NFS_SWAP NFS_V4_1 NFS_V4_2 PNFS_FILE_LAYOUT NFS_V4_1_MIGRATION ROOT_NFS \
		NFS_USE_KERNEL_DNS GRACE_PERIOD LOCKD LOCKD_V4 NFS_COMMON CIFS_STATS CIFS_STATS2 CIFS_SMB2 CIFS_SMB311 CIFS_FSCACHE \
		CIFS_UPCALL CIFS_XATTR CIFS_POSIX CIFS_ACL CEPH_FSCACHE CEPH_FS_POSIX_ACL UBIFS_FS UBIFS_FS_ADVANCED_COMPR UBIFS_FS_LZO \
		UBIFS_FS_ZLIB UBIFS_ATIME_SUPPORT UBIFS_FS_XATTR UBIFS_FS_ENCRYPTION UBIFS_FS_SECURITY OCFS2_FS OCFS2_FS_O2CB OCFS2_DEBUG_MASKLOG \
		NLS_ISO8859_1 NLS_CODEPAGE_437
	nconfig SQUASHFS_FILE_CACHE SQUASHFS_DECOMP_SINGLE SQUASHFS_DECOMP_MULTI_PERCPU SQUASHFS_4K_DEVBLK_SIZE SQUASHFS_EMBEDDED \
		NFSD NFS_USE_LEGACY_DNS CIFS_WEAK_PW_HASH CIFS_DEBUG CIFS_DEBUG2 CIFS_DFS_UPCALL OCFS2_DEBUG_FS OCFS2_FS_STATS
	mconfig DMI_SYSFS FUSE_FS NFS_FS PNFS_FLEXFILE_LAYOUT RPCSEC_GSS_KRB5 CIFS CEPH_FS OCFS2_FS_USERSPACE_CLUSTER \
		NLS_CODEPAGE_737 NLS_CODEPAGE_775 NLS_CODEPAGE_850 NLS_CODEPAGE_852 NLS_CODEPAGE_855 NLS_CODEPAGE_857 \
		NLS_CODEPAGE_860 NLS_CODEPAGE_861 NLS_CODEPAGE_862 NLS_CODEPAGE_863 NLS_CODEPAGE_864 NLS_CODEPAGE_865 \
		NLS_CODEPAGE_866 NLS_CODEPAGE_869 NLS_CODEPAGE_936 NLS_CODEPAGE_950 NLS_CODEPAGE_932 NLS_CODEPAGE_949 \
		NLS_CODEPAGE_874 NLS_ISO8859_8 NLS_CODEPAGE_1250 NLS_CODEPAGE_1251 NLS_ASCII NLS_ISO8859_2 NLS_ISO8859_3 \
		NLS_ISO8859_4 NLS_ISO8859_5 NLS_ISO8859_6 NLS_ISO8859_7 NLS_ISO8859_9 NLS_ISO8859_13 NLS_ISO8859_14 \
		NLS_ISO8859_15 NLS_KOI8_R NLS_KOI8_U NLS_MAC_ROMAN NLS_MAC_CELTIC NLS_MAC_CENTEURO NLS_MAC_CROATIAN \
		NLS_MAC_CYRILLIC NLS_MAC_GAELIC NLS_MAC_GREEK NLS_MAC_ICELAND NLS_MAC_INUIT NLS_MAC_ROMANIAN NLS_MAC_TURKISH

	# scsi, sata and pata
	yconfig BLK_DEV_INITRD BLK_DEV_LOOP BLK_DEV_RAM VIRTIO_BLK BLK_DEV_CRYPTOLOOP ISCSI_IBFT_FIND BLK_SCSI_REQUEST \
		BLK_DEV_BSG BLK_DEV_BSGLIB BLK_DEV_INTEGRITY BLK_DEV_ZONED BLK_DEV_THROTTLING SCSI_MOD RAID_ATTRS SCSI SCSI_DMA SCSI_NETLINK \
		SCSI_PROC_FS BLK_DEV_SD CHR_DEV_ST CHR_DEV_OSST BLK_DEV_SR BLK_DEV_SR_VENDOR CHR_DEV_SG CHR_DEV_SCH SCSI_SPI_ATTRS \
		SCSI_FC_ATTRS SCSI_SAS_ATTRS SCSI_SAS_LIBSAS SCSI_SAS_ATA SCSI_SAS_HOST_SMP SCSI_LOWLEVEL ISCSI_BOOT_SYSFS \
		BLK_DEV_3W_XXXX_RAID SCSI_HPSA SCSI_3W_9XXX SCSI_3W_SAS SCSI_ACARD SCSI_AACRAID SCSI_AIC7XXX SCSI_AIC79XX \
		SCSI_AIC94XX SCSI_MVSAS SCSI_DPT_I2O SCSI_ADVANSYS SCSI_ARCMSR MEGARAID_NEWGEN MEGARAID_MM MEGARAID_MAILBOX \
		MEGARAID_SAS SCSI_MPT3SAS SCSI_MPT2SAS SCSI_UFSHCD SCSI_UFSHCD_PCI SCSI_UFSHCD_PLATFORM SCSI_HPTIOP SCSI_BUSLOGIC \
		SCSI_FLASHPOINT LIBFC LIBFCOE FCOE FCOE_FNIC SCSI_SNIC SCSI_DMX3191D SCSI_GDTH SCSI_ISCI SCSI_IPS SCSI_INITIO SCSI_INIA100 \
		SCSI_STEX SCSI_SYM53C8XX_MMIO SCSI_IPR SCSI_QLOGIC_1280 SCSI_PMCRAID SCSI_PM8001 SCSI_BFA_FC SCSI_VIRTIO SCSI_DH \
		ATA ATA_VERBOSE_ERROR ATA_ACPI SATA_PMP SATA_AHCI SATA_AHCI_PLATFORM SATA_INIC162X SATA_ACARD_AHCI SATA_SIL24 \
		ATA_SFF PDC_ADMA SATA_QSTOR SATA_SX4 ATA_BMDMA ATA_PIIX SATA_MV SATA_NV SATA_PROMISE SATA_SIL SATA_SIS \
		SATA_SVW SATA_ULI SATA_VIA SATA_VITESSE PATA_ALI PATA_AMD PATA_ARTOP PATA_ATIIXP PATA_ATP867X PATA_CMD64X \
		PATA_CYPRESS PATA_EFAR PATA_HPT366 PATA_HPT37X PATA_HPT3X2N PATA_HPT3X3 PATA_HPT3X3_DMA PATA_IT8213 \
		PATA_IT821X PATA_JMICRON PATA_MARVELL PATA_NETCELL PATA_NINJA32 PATA_NS87415 PATA_OLDPIIX PATA_OPTIDMA \
		PATA_PDC2027X PATA_PDC_OLD PATA_RADISYS PATA_RDC PATA_SCH PATA_SERVERWORKS PATA_SIL680 PATA_SIS PATA_TOSHIBA \
		PATA_TRIFLEX PATA_VIA PATA_WINBOND PATA_CMD640_PCI PATA_MPIIX PATA_NS87410 PATA_OPTI PATA_RZ1000
	mconfig SCSI_DH_RDAC SCSI_DH_HP_SW SCSI_DH_EMC SCSI_DH_ALUA SCSI_OSD_INITIATOR SCSI_OSD_ULD SCSI_CHELSIO_FCOE \
		QEDI QEDF SCSI_LPFC SCSI_DC395x=y SCSI_AM53C974 SCSI_WD719X SCSI_DEBUG SCSI_QLA_FC TCM_QLA2XXX SCSI_QLA_ISCSI \
		SCSI_PPA SCSI_IMM VMWARE_PVSCSI HYPERV_STORAGE SCSI_SMARTPQI MEGARAID_LEGACY SCSI_ESAS2R SCSI_MVUMI \
		SCSI_CXGB3_ISCSI SCSI_CXGB4_ISCSI SCSI_BNX2_ISCSI SCSI_BNX2X_FCOE BE2ISCSI ISCSI_TCP SCSI_SRP_ATTRS \
		SCSI_ISCSI_ATTRS SCSI_ENCLOSURE ISCSI_IBFT
	nconfig PATA_PLATFORM SATA_DWC SATA_ZPODD SCSI_OSD_DEBUG SCSI_LPFC_DEBUG_FS TCM_QLA2XXX_DEBUG \
		SCSI_IPR_TRACE SCSI_IPR_DUMP SCSI_IZIP_EPP16 SCSI_IZIP_SLOW_CTR SCSI_SNIC_DEBUG_FS SCSI_UFS_DWC_TC_PLATFORM \
		SCSI_UFS_DWC_TC_PCI SCSI_MVSAS_DEBUG SCSI_MVSAS_TASKLET AIC94XX_DEBUG AIC79XX_REG_PRETTY_PRINT AIC79XX_DEBUG_ENABLE \
		AIC7XXX_REG_PRETTY_PRINT AIC7XXX_DEBUG_ENABLE SCSI_CONSTANTS SCSI_LOGGING SCSI_SCAN_ASYNC SCSI_MQ_DEFAULT

	# mtd
	yconfig MTD_NAND_RICOH MTD_NAND_DISKONCHIP MTD_NAND_DISKONCHIP_PROBE_ADVANCED MTD_NAND_DISKONCHIP_PROBE_HIGH \
		MTD_NAND_DISKONCHIP_BBTWRITE MTD_NAND_DOCG4 MTD_NAND_CAFE MTD_NAND_NANDSIM MTD_NAND_PLATFORM MTD_ONENAND \
		MTD_ONENAND_VERIFY_WRITE MTD_ONENAND_GENERIC MTD_ONENAND_OTP MTD_ONENAND_2X_PROGRAM MTD_NAND_ECC \
		MTD_NAND_ECC_SMC MTD_NAND MTD_NAND_BCH MTD_NAND_ECC_BCH MTD_SM_COMMON MTD_NAND_DENALI \
		MTD_NAND_DENALI_PCI MTD_PMC551_BUGFIX MTD_COMPLEX_MAPPINGS
	mconfig MTD_PHYSMAP MTD_SBC_GXX MTD_AMD76XROM MTD_ICHXROM MTD_ESB2ROM MTD_CK804XROM MTD_SCB2_FLASH MTD_NET \
		MTD_L440GX MTD_PCI MTD_PCMCIA MTD_GPIO_ADDR MTD_INTEL_VR_NOR MTD_PLATRAM MTD_LATCH_ADDR MTD_PMC551 \
		MTD_SLRAM MTD_PHRAM MTD_MTDRAM MTD_BLOCK2MTD MTD_DOCG3 MTD_NAND_GPIO
	nconfig MTD_PMC551_DEBUG MTD_PCMCIA_ANONYMOUS MTD_PHYSMAP_COMPAT

	# nvme
	yconfig NVME_CORE BLK_DEV_NVME NVME_MULTIPATH NVME_FABRICS NVME_RDMA NVME_FC NVME_TARGET NVME_TARGET_LOOP \
		NVME_TARGET_RDMA NVME_TARGET_FC NVME_TARGET_FCLOOP

	# sdcard
	mconfig MMC_SDHCI_OF_ARASAN MMC_SDHCI_OF_AT91 MMC_SDHCI_OF_DWCMSHC MMC_SDHCI_CADENCE MMC_SDHCI_F_SDH30 MMC_WBSD \
		MMC_ALCOR MMC_TIFM_SD MMC_SPI MMC_SDRICOH_CS MMC_CB710 MMC_VIA_SDMMC MMC_VUB300 MMC_USHC MMC_USDHI6ROL0 \
		MMC_REALTEK_PCI MMC_REALTEK_USB MMC_CQHCI MMC_TOSHIBA_PCI MMC_MTK MMC_SDHCI_XENON MMC_SDHCI_OMAP MMC_SDHCI_AM654
	yconfig MMC_SDHCI MMC_SDHCI_PCI MMC_RICOH_MMC MMC_SDHCI_ACPI MMC_SDHCI_PLTFM \
		MMC PWRSEQ_EMMC PWRSEQ_SIMPLE PXP_MMC SSB_SDIOHOST_POSSIBLE SB_SDIOHOST MMC_BLOCK MMC_BLOCK_BOUNCE MMC_SDHCI \
		MMC_SDHCI_PCI MMC_SDHCI_ACPI MMC_SDHCI_IO_ACCESSORS MMC_SDHCI_ESDHC_IMX MMC_REALTEK_PCI \
		MMC_TOSHIBA_PCI MMC_AML MMC_ARMMMCI MMC_BCM2835 MMC_BCM2835_DMA MMC_BCM2835_SDHOST
	nconfig MMC_DEBUG MEMSTICK_DEBUG MEMSTICK_UNSAFE_RESUME MMC_WBSD

	# device mapper
	yconfig ATA_GENERIC MD BLK_DEV_MD MD_AUTODETECT MD_LINEAR MD_RAID0 MD_RAID1 MD_RAID10 MD_RAID456 MD_MULTIPATH \
		BLK_DEV_DM_BUILTIN BLK_DEV_DM DM_BUFIO DM_DEBUG_BLOCK_MANAGER_LOCKING DM_CRYPT DM_SNAPSHOT DM_MIRROR \
		DM_UEVENT DM_VERITY_FEC FUSION FUSION_SPI FUSION_FC FUSION_SAS FUSION_CTL FUSION_LAN
	mconfig DM_SWITCH DM_LOG_WRITES DM_INTEGRITY DM_ZONED TARGET_CORE TCM_IBLOCK TCM_FILEIO TCM_PSCSI TCM_USER2 \
		LOOPBACK_TARGET TCM_FC ISCSI_TARGET ISCSI_TARGET_CXGB4 SBP_TARGET DM_FLAKEY DM_VERITY DM_LOG_USERSPACE \
		DM_RAID DM_ZERO DM_MULTIPATH DM_MULTIPATH_QL DM_MULTIPATH_ST DM_THIN_PROVISIONING DM_CACHE DM_CACHE_SMQ DM_ERA \
		DM_BIO_PRISON DM_PERSISTENT_DATA DM_UNSTRIPED MD_FAULTY MD_CLUSTER BCACHE
	nconfig FUSION_LOGGING DM_DELAY DM_WRITECACHE DM_DEBUG_BLOCK_STACK_TRACING DM_MQ_DEFAULT DM_DEBUG BCACHE_DEBUG \
		BCACHE_CLOSURES_DEBUG

	# crypto
	yconfig CRYPTO_ALGAPI CRYPTO_ALGAPI2 CRYPTO_AEAD CRYPTO_AEAD2 CRYPTO_BLKCIPHER CRYPTO_BLKCIPHER2 CRYPTO_HASH \
		CRYPTO_HASH2 CRYPTO_RNG CRYPTO_RNG2 CRYPTO_RNG_DEFAULT CRYPTO_AKCIPHER2 CRYPTO_AKCIPHER CRYPTO_KPP2 CRYPTO_KPP \
		CRYPTO_ACOMP2 CRYPTO_RSA CRYPTO_DH CRYPTO_MANAGER CRYPTO_MANAGER2 CRYPTO_MANAGER_DISABLE_TESTS CRYPTO_GF128MUL \
		CRYPTO_NULL CRYPTO_NULL2 CRYPTO_WORKQUEUE CRYPTO_CRYPTD CRYPTO_AUTHENC CRYPTO_SIMD CRYPTO_GLUE_HELPER_X86 CRYPTO_CCM \
		CRYPTO_GCM CRYPTO_SEQIV CRYPTO_CBC CRYPTO_CTR CRYPTO_CTS CRYPTO_ECB CRYPTO_LRW CRYPTO_PCBC CRYPTO_XTS CRYPTO_HMAC \
		CRYPTO_CRC32C CRYPTO_CRC32 CRYPTO_CRCT10DIF CRYPTO_GHASH CRYPTO_MD4 CRYPTO_MD5 CRYPTO_MICHAEL_MIC CRYPTO_RMD160 CRYPTO_SHA1 \
		CRYPTO_SHA256 CRYPTO_SHA512 CRYPTO_TGR192 CRYPTO_WP512 CRYPTO_AES CRYPTO_AES_X86_64 CRYPTO_AES_NI_INTEL CRYPTO_ANUBIS \
		CRYPTO_ARC4 CRYPTO_BLOWFISH CRYPTO_BLOWFISH_COMMON CRYPTO_CAMELLIA CRYPTO_CAMELLIA_X86_64 CRYPTO_CAST_COMMON CRYPTO_CAST5 \
		CRYPTO_CAST6 CRYPTO_DES CRYPTO_FCRYPT CRYPTO_KHAZAD CRYPTO_SEED CRYPTO_SERPENT CRYPTO_SERPENT_SSE2_X86_64 CRYPTO_TEA \
		CRYPTO_TWOFISH CRYPTO_TWOFISH_COMMON CRYPTO_TWOFISH_X86_64 CRYPTO_DEFLATE CRYPTO_LZO CRYPTO_842 CRYPTO_DRBG_MENU CRYPTO_DRBG_HMAC \
		CRYPTO_DRBG_HASH CRYPTO_DRBG_CTR CRYPTO_DRBG CRYPTO_JITTERENTROPY CRYPTO_HASH_INFO CRYPTO_HW CRYPTO_DEV_CCP \
		CRYPTO_DEV_SP_CCP CRYPTO_DEV_SP_PSP CHELSIO_IPSEC_INLINE ASYMMETRIC_KEY_TYPE ASYMMETRIC_PUBLIC_KEY_SUBTYPE X509_CERTIFICATE_PARSER \
		PKCS7_MESSAGE_PARSER SIGNED_PE_FILE_VERIFICATION CRYPTO_OFB
	mconfig CRYPTO_PAES_S390 CRYPTO_SHA1_S390 CRYPTO_SHA256_S390 CRYPTO_SHA512_S390 CRYPTO_DES_S390 CRYPTO_AES_S390 CRYPTO_GHASH_S390 \
		CRYPTO_CRC32_S390 CRYPTO_DEV_CHELSIO_TLS CRYPTO_DEV_VIRTIO CRYPTO_DEV_QAT \
		CRYPTO_DEV_QAT_DH895xCC CRYPTO_DEV_QAT_C3XXX CRYPTO_DEV_QAT_C62X CRYPTO_DEV_QAT_DH895xCCVF \
		CRYPTO_DEV_QAT_C3XXXVF CRYPTO_DEV_QAT_C62XVF CRYPTO_DEV_NITROX CRYPTO_DEV_NITROX_CNN55XX \
		CRYPTO_DEV_CHELSIO CRYPTO_DEV_CCP_CRYPTO CRYPTO_DEV_CCP_DD CRYPTO_DEV_PADLOCK \
		CRYPTO_DEV_PADLOCK_AES CRYPTO_DEV_PADLOCK_SHA CRYPTO_USER_API CRYPTO_USER_API_HASH \
		CRYPTO_USER_API_SKCIPHER CRYPTO_USER_API_RNG CRYPTO_USER_API_AEAD CRYPTO_LZ4 \
		CRYPTO_LZ4HC CRYPTO_ZSTD CRYPTO_ANSI_CPRNG CRYPTO_TWOFISH_X86_64_3WAY \
		CRYPTO_TWOFISH_AVX_X86_64 CRYPTO_SERPENT_AVX_X86_64 CRYPTO_SERPENT_AVX2_X86_64 \
		CRYPTO_SM4 CRYPTO_SALSA20 CRYPTO_CHACHA20 CRYPTO_CHACHA20_X86_64 CRYPTO_DES3_EDE_X86_64 \
		CRYPTO_CAST6_AVX_X86_64 CRYPTO_CAST5_AVX_X86_64 CRYPTO_CAMELLIA_AESNI_AVX_X86_64 \
		CRYPTO_CAMELLIA_AESNI_AVX2_X86_64 CRYPTO_BLOWFISH_X86_64 CRYPTO_AES_TI CRYPTO_GHASH_CLMUL_NI_INTEL \
		CRYPTO_SHA3 CRYPTO_SM3 CRYPTO_SHA1_SSSE3 CRYPTO_SHA256_SSSE3 CRYPTO_SHA512_SSSE3 CRYPTO_SHA1_MB \
		CRYPTO_SHA256_MB CRYPTO_SHA512_MB CRYPTO_RMD256 CRYPTO_RMD320 CRYPTO_RMD128 CRYPTO_POLY1305 \
		CRYPTO_POLY1305_X86_64 CRYPTO_CRCT10DIF_PCLMUL CRYPTO_CRC32_PCLMUL CRYPTO_CRC32C_INTEL CRYPTO_XCBC \
		CRYPTO_VMAC CRYPTO_KEYWRAP CRYPTO_CMAC CRYPTO_CFB CRYPTO_ECHAINIV CRYPTO_CHACHA20POLY1305 \
		CRYPTO_AEGIS128 CRYPTO_AEGIS128L CRYPTO_AEGIS256 CRYPTO_AEGIS128_AESNI_SSE2 CRYPTO_AEGIS128L_AESNI_SSE2 \
		CRYPTO_AEGIS256_AESNI_SSE2 CRYPTO_MORUS640 CRYPTO_MORUS640_GLUE CRYPTO_MORUS640_SSE2 CRYPTO_MORUS1280 \
		CRYPTO_MORUS1280_GLUE CRYPTO_MORUS1280_SSE2 CRYPTO_MORUS1280_AVX2 CRYPTO_ENGINE CRYPTO_TEST \
		CRYPTO_MCRYPTD CRYPTO_PCRYPT CRYPTO_USER CRYPTO_ECDH CRYPTO_NHPOLY1305_SSE2 CRYPTO_NHPOLY1305_AVX2 CRYPTO_ADIANTUM \
		CRYPTO_STREEBOG CRYPTO_DEV_QAT_DH895xCCVF CRYPTO_DEV_QAT_DH895xCC
	nconfig PKCS7_TEST_KEY

	# HID drivers
	mconfig HID_A4TECH HID_ACCUTOUCH HID_ACRUX HID_ACRUX_FF HID_APPLE HID_APPLEIR HID_ASUS HID_AUREAL HID_BELKIN HID_BETOP_FF \
		HID_CHERRY HID_CHICONY HID_CORSAIR HID_PRODIKEYS HID_CMEDIA HID_CP2112 HID_CYPRESS HID_DRAGONRISE DRAGONRISE_FF \
		HID_EMS_FF HID_ELAN HID_ELECOM HID_ELO HID_EZKEY HID_GEMBIRD HID_GFRM HID_HOLTEK HOLTEK_FF HID_GOOGLE_HAMMER \
		HID_GT683R HID_KEYTOUCH HID_KYE HID_UCLOGIC HID_WALTOP HID_GYRATION HID_ICADE HID_IT HID_JABRA HID_TWINHAN HID_KENSINGTON \
		HID_LCPOWER HID_LED HID_LENOVO HID_LOGITECH HID_LOGITECH_DJ HID_LOGITECH_HIDPP LOGITECH_FF LOGIRUMBLEPAD2_FF LOGIG940_FF \
		LOGIWHEELS_FF HID_MAGICMOUSE HID_MAYFLASH HID_MICROSOFT HID_MONTEREY HID_MULTITOUCH HID_NTI HID_NTRIG HID_ORTEK HID_PANTHERLORD \
		PANTHERLORD_FF HID_PENMOUNT HID_PETALYNX HID_PICOLCD _HID_PICOLCD_FB HID_PICOLCD_BACKLIGHT HID_PICOLCD_LCD HID_PICOLCD_LEDS \
		HID_PICOLCD_CIR HID_PLANTRONICS HID_PRIMAX _HID_RETRODE HID_ROCCAT HID_SAITEK HID_SAMSUNG HID_SONY SONY_FF HID_SPEEDLINK \
		HID_STEELSERIES HID_SUNPLUS HID_RMI HID_GREENASIA GREENASIA_FF HID_HYPERV_MOUSE HID_SMARTJOYPLUS SMARTJOYPLUS_FF \
		HID_TIVO HID_TOPSEED HID_THINGM HID_THRUSTMASTER HID_UDRAW_PS3 HID_WACOM HID_WIIMOTE HID_XINMO \
		HID_ZEROPLUS ZEROPLUS_FF HID_ZYDACRON HID_SENSOR_HUB HID_ALPS INTEL_ISH_HID
	yconfig THRUSTMASTER_FF

	# fixes
	yconfig IP_MROUTE IPV6_ROUTER_PREF IPV6_OPTIMISTIC_DAD IPV6_MULTIPLE_TABLES IPV6_MROUTE XPS LOGITECH_FF \
		LOGIRUMBLEPAD2_FF LOGIG940_FF LOGIWHEELS_FF PANTHERLORD_FF SONY_FF IP_VS_PROTO_TCP IP_VS_PROTO_UDP \
		L2TP_V3 IP_VS_PROTO_ESP IP_VS_PROTO_AH IPV6_ROUTE_INFO IPV6_PIMSM_V2 HID_ACRUX_FF DRAGONRISE_FF \
		HOLTEK_FF HID_PICOLCD_BACKLIGHT HID_PICOLCD_LCD HID_PICOLCD_LEDS HID_PICOLCD_CIR GREENASIA_FF SMARTJOYPLUS_FF ZEROPLUS_FF

	strconfig DEFAULT_HOSTNAME azusa
	strconfig UEVENT_HELPER_PATH ""
	strconfig NLS_DEFAULT "utf8"
	strconfig FAT_DEFAULT_IOCHARSET "ascii"
	strconfig DEFAULT_TCP_CONG "cubic"
	strconfig MAC80211_RC_DEFAULT "minstrel_ht"
	strconfig DEFAULT_SECURITY "tomoyo"
	strconfig EXTRA_FIRMWARE_DIR "/lib/firmware"
	strconfig NFS_V4_1_IMPLEMENTATION_ID_DOMAIN "kernel.org"
	varconfig MAC80211_STA_HASH_MAX_SIZE 0
	varconfig FAT_DEFAULT_CODEPAGE 437
	varconfig HZ 300
	varconfig BLK_DEV_LOOP_MIN_COUNT 0
	varconfig SND_HDA_PREALLOC_SIZE 2048
	varconfig MTDRAM_TOTAL_SIZE 4096
	varconfig MTDRAM_ERASE_SIZE 128
	varconfig MTD_NAND_DISKONCHIP_PROBE_ADDRESS 0
	varconfig SATA_MOBILE_LPM_POLICY 3
	varconfig SCSI_OSD_DPRINT_SENSE 1
	varconfig SCSI_SYM53C8XX_DMA_ADDRESSING_MODE 1
	varconfig SCSI_SYM53C8XX_DEFAULT_TAGS 16
	varconfig SCSI_SYM53C8XX_MAX_TAGS 64
	varconfig SCSI_MPT2SAS_MAX_SGE 128
	varconfig SCSI_MPT3SAS_MAX_SGE 128
	varconfig AIC79XX_CMDS_PER_DEVICE 4
	varconfig AIC79XX_RESET_DELAY_MS 15000
	varconfig AIC79XX_DEBUG_MASK 0
	varconfig AIC7XXX_CMDS_PER_DEVICE 4
	varconfig AIC7XXX_RESET_DELAY_MS 15000
	varconfig AIC7XXX_DEBUG_MASK 0
	varconfig FUSION_MAX_SGE 128

	if [ "$CROSS" = "yes" ]; then
		yes '' | make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} olddefconfig
	else
		yes '' | make ARCH=$XKARCH olddefconfig
	fi

	sed -i "s/.*DEBUG_INFO.*/\\# DEBUG_INFO is not set/" .config
	sed -i "s/.*CONFIG_LOGO_LINUX_CLUT224.*/CONFIG_LOGO_LINUX_CLUT224=y/" .config
}

build() {
	case $BARCH in
		x86_64)
			export XKARCH="x86_64"
			export IMAGELOC="arch/x86/boot/bzImage"
			;;
		i586)
			export XKARCH="i386"
			export IMAGELOC="arch/x86/boot/bzImage"
			;;
		aarch64)
			export XKARCH="arm64"
			export IMAGELOC="arch/arm64/boot/Image"
			;;
		armv7l|armv6l|armv5tel|armv5tel)
			export XKARCH="arm"
			export IMAGELOC="arch/arm/boot/zImage"
			;;
		mips|mipsel)
			export XKARCH="mips"
			export IMAGELOC="vmlinux"
			;;
		ppc64le|ppc64|ppc)
			export XKARCH="powerpc"
			export IMAGELOC="vmlinux"
			;;
		s390x)
			export XKARCH="s390"
			export IMAGELOC="arch/s390/boot/bzImage"
			;;
		riscv64|riscv32)
			export XKARCH="riscv"
			export IMAGELOC="vmlinux"
			;;
		*)
			echo "Architecture is not set or is not supported by Ataraxia Linux"
			exit 1
	esac

	cd "$SRC"
	gunzip reiser4-for-$reiser4ver.patch.gz

	cd $name-$version
	patch -Np1 -i "$STUFF"/linux/wireguard.patch
	patch -Np1 -i "$SRC"/reiser4-for-$reiser4ver.patch

	unset LDFLAGS
	make mrproper


	if [ "$CROSS" != "yes" ]; then
		if [ -f /boot/config-linux ]; then
			cp /boot/config-linux .config
		else
			generate_config
		fi
	else
		generate_config
	fi

	if [ "$CROSS" = "yes" ]; then
		yes '' | make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE}
	else
		yes '' | make ARCH=$XKARCH
	fi

	if [ "$CROSS" = "yes" ]; then
		make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} INSTALL_MOD_STRIP=1 INSTALL_MOD_PATH="$PKG"/usr modules_install
	else
		make ARCH=$XKARCH INSTALL_MOD_STRIP=1 INSTALL_MOD_PATH="$PKG"/usr modules_install
	fi

	case $BARCH in
		aarch64|armv7l|armv6l|armv5tel|armv5tel)
			if [ "$CROSS" = "yes" ]; then
				make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} INSTALL_DTBS_PATH="$PKG"/boot/dtbs dtbs_install
			else
				make ARCH=$XKARCH INSTALL_DTBS_PATH="$PKG"/boot/dtbs dtbs_install
			fi
			;;
	esac

	mkdir -p "$PKG"/boot
	cp "$IMAGELOC" "$PKG"/boot/vmlinuz-linux
	cp .config "$PKG"/boot/config-linux

	rm -rf "$PKG"/lib/modules/*/{build,source}
}
