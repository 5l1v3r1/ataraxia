# Description: IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator
# URL:         https://w1.fi/hostapd/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  libressl libnl
# Section:     net

name=hostapd
version=2.9
release=1
source=("https://w1.fi/releases/$name-$version.tar.gz")

build() {
	export CFLAGS="$(pkg-config --cflags libnl-3.0) $CFLAGS"

	cd "$SRC"/$name-$version
	patch -Np1 -i "$STUFF"/wpa_supplicant/eloop.patch

	cp "$STUFF"/hostapd/config $name/.config
	sed -i 's#/etc/hostapd#/etc/hostapd/hostapd#' $name/hostapd.conf

	cd $name
	make

	install -d "$PKG"/usr/bin
	for a in hostapd hostapd_cli; do
		install -m755 $a "$PKG"/usr/bin/$a
	done

	install -d "$PKG"/etc/hostapd

	install -Dm644 hostapd.8 "$PKG"/usr/share/man/man8/hostapd.8
	install -Dm644 hostapd_cli.1 "$PKG"/usr/share/man/man1/hostapd_cli.1

	for svc in hostapd; do
		install -Dm0755 "$STUFF"/svc/$svc-run "$PKG"/etc/service/$svc/run
	done
}
