# Description: A daemon which implements the Point-to-Point Protocol for dial-up networking
# URL:         https://www.samba.org/ppp/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  zlib libressl libpcap

name=ppp
version=347904e33a8a1993316e57445a1ba8243cd947ce
release=1
source=("https://github.com/paulusmack/ppp/archive/$version.tar.gz")

build() {
	export CFLAGS="$CFLAGS -D_GNU_SOURCE"

	cd "$SRC"/$name-$version
	sed -i "s:^#FILTER=y:FILTER=y:" pppd/Makefile.linux
	sed -i "s:^#HAVE_INET6=y:HAVE_INET6=y:" pppd/Makefile.linux
	sed -i "s:^#CBCP=y:CBCP=y:" pppd/Makefile.linux
	sed -i "s:-O2 -pipe -Wall -g:${CFLAGS}:" pppd/Makefile.linux
	sed -i "s:-g -O2:${CFLAGS}:" pppd/plugins/Makefile.linux
	sed -i "s:-O2:${CFLAGS}:" pppstats/Makefile.linux
	sed -i "s:-O2 -g -pipe:${CFLAGS}:" chat/Makefile.linux
	sed -i "s:-O:${CFLAGS}:" pppdump/Makefile.linux

	./configure $BUILDFLAGS \
		--prefix=/usr \
		--sysconfdir=/etc
	make
	make -j1 INSTROOT="$PKG" install install-etcppp

	install -D -m755 "$STUFF"/svc/pppd.initd "$PKG"/etc/init.d/pppd

	chmod +w -R $PKG
}
