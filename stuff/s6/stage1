#!/usr/bin/execlineb -S0

cd /
s6-setsid -qb
umask 022

ifelse -nX {
    if { mount -t tmpfs run /run -o mode=0755,nosuid,nodev }
    if { mkdir -p /run/s6 }
    if { cp -a -- /etc/svc /run/s6 }
}

redirfd -r 0 /dev/null
redirfd -wnb 1 /run/s6/s6-svscan-log/fifo
fdmove -c 2 1

background {
    s6-setsid --
    redirfd -w 1 /run/s6/s6-svscan-log/fifo
    /etc/s6/rc.sysinit
}

unexport !
s6-svscan -st0 /run/s6
