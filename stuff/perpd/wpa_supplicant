#!/bin/sh
#

exec 2>&1

TARGET="$1"
IFUP="$(echo $0 | cut -d @ -f 2 | sed -e 's/\/rc.main//g')"
SVNAME="${2:-wpa_supplicant-$IFUP}"

start() {
	echo "Starting ${SVNAME} on ${IFUP}..."
	ip link set ${IFUP} up

	exec wpa_supplicant -B -i ${IFUP} -c /etc/wpa_supplicant/wpa_supplicant.conf &
	exec udhcpc -b -i ${IFUP}
}

reset() {
	case $3 in
		exit)
			echo "Stopping ${SVNAME}..."
			killall udhcpc
			killall wpa_supplicant

			ip link set ${IFUP} down
			;;
		signal)
			echo "Killing ${SVNAME}..."
			;;
		*)
			echo "Stopping ${SVNAME}..."
			;;
	esac
}

eval ${TARGET} "$@"
