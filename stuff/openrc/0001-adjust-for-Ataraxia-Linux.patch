From 1f0ad6979fd4a18323d2b41c209e271627a28ee4 Mon Sep 17 00:00:00 2001
From: Ishimoto Shinobu <nagakamira@gmail.com>
Date: Wed, 8 Jan 2020 19:16:26 +0900
Subject: [PATCH] adjust for Ataraxia Linux

Signed-off-by: Ishimoto Shinobu <nagakamira@gmail.com>
---
 etc/rc.conf        | 2 +-
 init.d/mount-ro.in | 4 ++++
 init.d/swap.in     | 4 ++++
 3 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/etc/rc.conf b/etc/rc.conf
index 123d58e..b6bfcab 100644
--- a/etc/rc.conf
+++ b/etc/rc.conf
@@ -7,7 +7,7 @@
 # WARNING: whilst we have improved parallel, it can still potentially lock
 # the boot process. Don't file bugs about this unless you can supply
 # patches that fix it without breaking other things!
-#rc_parallel="NO"
+rc_parallel="YES"
 
 # Set rc_interactive to "YES" and you'll be able to press the I key during
 # boot so you can choose to start specific services. Set to "NO" to disable
diff --git a/init.d/mount-ro.in b/init.d/mount-ro.in
index aa7a57c..43cff75 100644
--- a/init.d/mount-ro.in
+++ b/init.d/mount-ro.in
@@ -24,6 +24,10 @@ start()
 	# Flush all pending disk writes now
 	sync
 
+	if [ -x "/usr/bin/smem" ]; then
+		smem
+	fi
+
 	ebegin "Remounting remaining filesystems read-only"
 	# We need the do_unmount function
 	. "$RC_LIBEXECDIR"/sh/rc-mount.sh
diff --git a/init.d/swap.in b/init.d/swap.in
index c40b263..8b3b479 100644
--- a/init.d/swap.in
+++ b/init.d/swap.in
@@ -29,6 +29,10 @@ start()
 stop()
 {
 	ebegin "Deactivating swap devices"
+	if [ -x "/usr/bin/sswap" ]; then
+		sswap
+	fi
+
 	case "$RC_UNAME" in
 		NetBSD|OpenBSD)	swapctl -U -t noblk >/dev/null;;
 		*)		swapoff -a >/dev/null;;
-- 
2.24.0

