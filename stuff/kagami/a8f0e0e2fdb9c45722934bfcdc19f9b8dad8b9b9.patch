From a8f0e0e2fdb9c45722934bfcdc19f9b8dad8b9b9 Mon Sep 17 00:00:00 2001
From: Ishimoto Shinobu <nagakamira@gmail.com>
Date: Wed, 17 Jul 2019 03:27:38 +0900
Subject: [PATCH] try

Signed-off-by: Ishimoto Shinobu <nagakamira@gmail.com>
---
 kagami.in | 48 +++++++++++++++++++++---------------------------
 1 file changed, 21 insertions(+), 27 deletions(-)

diff --git a/kagami.in b/kagami.in
index b83088d..dad1f48 100755
--- a/kagami.in
+++ b/kagami.in
@@ -220,38 +220,38 @@ run_strip() {
 }
 
 parse_options() {
-	for myopts in ${options[@]} ${OPTIONS[@]}; do
+	for myopts in ${OPTIONS[@]} ${options[@]}; do
 		case $myopts in
-			~emptydirs)
-				OPT_EMPTYDIRS=0
-				;;
 			emptydirs)
 				OPT_EMPTYDIRS=1
 				;;
-			~strip)
-				OPT_STRIP=0
+			~emptydirs)
+				OPT_EMPTYDIRS=0
 				;;
 			strip)
 				OPT_STRIP=1
 				;;
-			~makeflags)
-				OPT_MAKEFLAGS=0
+			~strip)
+				OPT_STRIP=0
 				;;
 			makeflags)
 				OPT_MAKEFLAGS=1
 				;;
-			~locales)
-				OPT_LOCALES=0
+			~makeflags)
+				OPT_MAKEFLAGS=0
 				;;
 			locales)
 				OPT_LOCALES=1
 				;;
-			~docs)
-				OPT_DOCS=0
+			~locales)
+				OPT_LOCALES=0
 				;;
 			docs)
 				OPT_DOCS=1
 				;;
+			~docs)
+				OPT_DOCS=0
+				;;
 			~bootstrap)
 				OPT_BOOTSTRAP=0
 				;;
@@ -770,22 +770,16 @@ emerge_package() {
 		source_recipe
 		build_package
 		if [ "$NOPACKAGE" != "yes" ]; then
-			if [ "$NEEDED" = "yes" ]; then
-				if [ -f "$ROOTDIR/$PACKAGES/$pkg/METADATA" ]; then
-					warntwo "This package has been already installed"
-					exit 0
-				fi
-			fi
-			(
-				set -e
-				install_package
-			)
-			if [ $? = 0 ]; then
-				INSTALL_SUCCESS="yes"
-			fi
-			if [ "$INSTALL_SUCCESS" != "yes" ]; then
-				die -2 "Failed to emerge package"
+			if [ ! -f "$TARGET" ]; then
+				die -2 "Package file wasn't found"
 			fi
+			install_package
+		fi
+		if [ $? = 0 ]; then
+			INSTALL_SUCCESS="yes"
+		fi
+		if [ "$INSTALL_SUCCESS" != "yes" ]; then
+			die -2 "Failed to emerge package"
 		fi
 
 	popd
